// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;
using SpanWriter = FourSer.Gen.Helpers.SpanWriterHelpers;
using StreamWriter = FourSer.Gen.Helpers.StreamWriterHelpers;

namespace FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable;

public partial class Inventory : ISerializable<Inventory>
{
    public static int GetPacketSize(Inventory obj)
    {
        var size = 0;
        size += sizeof(int); // Count size for Items
        size += sizeof(byte); // Size for polymorphic type id
        var collectionItems = obj.Items?.ToList();
        if (collectionItems is not null && collectionItems.Count > 0)
        {
            var firstItem = collectionItems[0];
            switch(firstItem)
            {
                case Sword:
                {
                    foreach(var item in collectionItems)
                    {
                        size += Sword.GetPacketSize((Sword)item);
                    }
                    break;
                }
                case Shield:
                {
                    foreach(var item in collectionItems)
                    {
                        size += Shield.GetPacketSize((Shield)item);
                    }
                    break;
                }
                case Potion:
                {
                    foreach(var item in collectionItems)
                    {
                        size += Potion.GetPacketSize((Potion)item);
                    }
                    break;
                }
                default: throw new System.IO.InvalidDataException($"Unknown item type in collection Items: {firstItem.GetType().Name}");
            }
        }
        return size;
    }

    private Inventory(System.Collections.Generic.IEnumerable<FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.Item> items)
    {
        this.Items = items;
    }

    public Inventory()
    {
        this.Items = default;
    }

    public static Inventory Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var itemsCount = SpanReader.ReadInt32(ref buffer);
        var items = new System.Collections.Generic.List<FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.Item>(itemsCount);
        var typeId = SpanReader.ReadByte(ref buffer);
        switch (typeId)
        {
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Sword.Deserialize(ref buffer);
                    items.Add(item);
                }
                break;
            }
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Shield.Deserialize(ref buffer);
                    items.Add(item);
                }
                break;
            }
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Potion.Deserialize(ref buffer);
                    items.Add(item);
                }
                break;
            }
            default:
                throw new System.IO.InvalidDataException($"Unknown type id for Items: {typeId}");
        }
        var obj = new Inventory(items);
        return obj;
    }

    public static Inventory Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static Inventory Deserialize(System.IO.Stream stream)
    {
        var itemsCount = StreamReader.ReadInt32(stream);
        var items = new System.Collections.Generic.List<FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.Item>(itemsCount);
        var typeId = StreamReader.ReadByte(stream);
        switch (typeId)
        {
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Sword.Deserialize(stream);
                    items.Add(item);
                }
                break;
            }
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Shield.Deserialize(stream);
                    items.Add(item);
                }
                break;
            }
            case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion:
            {
                for (int i = 0; i < itemsCount; i++)
                {
                    var item = Potion.Deserialize(stream);
                    items.Add(item);
                }
                break;
            }
            default:
                throw new System.IO.InvalidDataException($"Unknown type id for Items: {typeId}");
        }
        var obj = new Inventory(items);
        return obj;
    }

    public static int Serialize(Inventory obj, System.Span<byte> data)
    {
        var originalData = data;
        if (obj.Items is null)
        {
            throw new System.NullReferenceException($"Collection \"Items\" cannot be null.");
        }
        else
        {
            var collectionItems = obj.Items.ToList();
            if (collectionItems is null || collectionItems.Count == 0)
            {
                SpanWriter.WriteInt32(ref data, (int)0);
                SpanWriter.WriteByte(ref data, (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword);
            }
            else
            {
                SpanWriter.WriteInt32(ref data, (int)collectionItems.Count);
                var firstItem = collectionItems[0];
                var discriminator = firstItem switch
                {
                    Sword => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword,
                    Shield => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield,
                    Potion => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion,
                    _ => throw new System.IO.InvalidDataException($"Unknown item type: {firstItem.GetType().Name}")
                };
                SpanWriter.WriteByte(ref data, discriminator);
                switch (discriminator)
                {
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            var bytesWritten = Sword.Serialize((Sword)collectionItems[i], data);
                            data = data.Slice(bytesWritten);
                        }
                        break;
                    }
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            var bytesWritten = Shield.Serialize((Shield)collectionItems[i], data);
                            data = data.Slice(bytesWritten);
                        }
                        break;
                    }
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            var bytesWritten = Potion.Serialize((Potion)collectionItems[i], data);
                            data = data.Slice(bytesWritten);
                        }
                        break;
                    }
                }
            }
        }
        return originalData.Length - data.Length;
    }

    public static void Serialize(Inventory obj, System.IO.Stream stream)
    {
        if (obj.Items is null)
        {
            throw new System.NullReferenceException($"Collection \"Items\" cannot be null.");
        }
        else
        {
            var collectionItems = obj.Items.ToList();
            if (collectionItems is null || collectionItems.Count == 0)
            {
                StreamWriter.WriteInt32(stream, (int)0);
                StreamWriter.WriteByte(stream, (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword);
            }
            else
            {
                StreamWriter.WriteInt32(stream, (int)collectionItems.Count);
                var firstItem = collectionItems[0];
                var discriminator = firstItem switch
                {
                    Sword => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword,
                    Shield => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield,
                    Potion => (byte)(byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion,
                    _ => throw new System.IO.InvalidDataException($"Unknown item type: {firstItem.GetType().Name}")
                };
                StreamWriter.WriteByte(stream, discriminator);
                switch (discriminator)
                {
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Sword:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            Sword.Serialize((Sword)collectionItems[i], stream);
                        }
                        break;
                    }
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Shield:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            Shield.Serialize((Shield)collectionItems[i], stream);
                        }
                        break;
                    }
                    case (byte)FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable.ItemTypeId.Potion:
                    {
                        for (int i = 0; i < collectionItems.Count; i++)
                        {
                            Potion.Serialize((Potion)collectionItems[i], stream);
                        }
                        break;
                    }
                }
            }
        }
    }
}


// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;
using SpanWriter = FourSer.Gen.Helpers.SpanWriterHelpers;
using StreamWriter = FourSer.Gen.Helpers.StreamWriterHelpers;

namespace FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable;

public partial class Item : ISerializable<Item>
{
    public static int GetPacketSize(Item obj)
    {
        var size = 0;
        return size;
    }

    public Item()
    {
    }

    public static Item Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var obj = new Item();
        return obj;
    }

    public static Item Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static Item Deserialize(System.IO.Stream stream)
    {
        var obj = new Item();
        return obj;
    }

    public static int Serialize(Item obj, System.Span<byte> data)
    {
        var originalData = data;
        return originalData.Length - data.Length;
    }

    public static void Serialize(Item obj, System.IO.Stream stream)
    {
    }
}


// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;
using SpanWriter = FourSer.Gen.Helpers.SpanWriterHelpers;
using StreamWriter = FourSer.Gen.Helpers.StreamWriterHelpers;

namespace FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable;

public partial class Sword : ISerializable<Sword>
{
    public static int GetPacketSize(Sword obj)
    {
        var size = 0;
        return size;
    }

    public Sword()
    {
    }

    public static new Sword Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var obj = new Sword();
        return obj;
    }

    public static new Sword Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static new Sword Deserialize(System.IO.Stream stream)
    {
        var obj = new Sword();
        return obj;
    }

    public static int Serialize(Sword obj, System.Span<byte> data)
    {
        var originalData = data;
        return originalData.Length - data.Length;
    }

    public static void Serialize(Sword obj, System.IO.Stream stream)
    {
    }
}


// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;
using SpanWriter = FourSer.Gen.Helpers.SpanWriterHelpers;
using StreamWriter = FourSer.Gen.Helpers.StreamWriterHelpers;

namespace FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable;

public partial class Shield : ISerializable<Shield>
{
    public static int GetPacketSize(Shield obj)
    {
        var size = 0;
        return size;
    }

    public Shield()
    {
    }

    public static new Shield Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var obj = new Shield();
        return obj;
    }

    public static new Shield Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static new Shield Deserialize(System.IO.Stream stream)
    {
        var obj = new Shield();
        return obj;
    }

    public static int Serialize(Shield obj, System.Span<byte> data)
    {
        var originalData = data;
        return originalData.Length - data.Length;
    }

    public static void Serialize(Shield obj, System.IO.Stream stream)
    {
    }
}


// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;
using SpanWriter = FourSer.Gen.Helpers.SpanWriterHelpers;
using StreamWriter = FourSer.Gen.Helpers.StreamWriterHelpers;

namespace FourSer.Tests.GeneratorTestCases.PolymorphicCollectionIEnumerable;

public partial class Potion : ISerializable<Potion>
{
    public static int GetPacketSize(Potion obj)
    {
        var size = 0;
        return size;
    }

    public Potion()
    {
    }

    public static new Potion Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var obj = new Potion();
        return obj;
    }

    public static new Potion Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static new Potion Deserialize(System.IO.Stream stream)
    {
        var obj = new Potion();
        return obj;
    }

    public static int Serialize(Potion obj, System.Span<byte> data)
    {
        var originalData = data;
        return originalData.Length - data.Length;
    }

    public static void Serialize(Potion obj, System.IO.Stream stream)
    {
    }
}
