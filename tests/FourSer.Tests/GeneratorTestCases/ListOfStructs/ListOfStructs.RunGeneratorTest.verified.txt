// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;

namespace FourSer.Tests.GeneratorTestCases.ListOfStructs;

public partial struct MyStruct : ISerializable<MyStruct>
{
    public static int GetPacketSize(MyStruct obj)
    {
        var size = 0;
        size += sizeof(int); // Size for unmanaged type A
        return size;
    }

    private MyStruct(int a)
    {
        this.A = a;
    }


    public static MyStruct Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var a = SpanReader.ReadInt32(ref buffer);
        var obj = new MyStruct(a);
        return obj;
    }

    public static MyStruct Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static MyStruct Deserialize(System.IO.Stream stream)
    {
        var a = StreamReader.ReadInt32(stream);
        var obj = new MyStruct(a);
        return obj;
    }

    public static int Serialize(MyStruct obj, System.Span<byte> data)
    {
        var originalData = data;
        FourSer.Gen.Helpers.SpanWriterHelpers.WriteInt32(ref data, (Int32)obj.A);
        return originalData.Length - data.Length;
    }

    public static void Serialize(MyStruct obj, System.IO.Stream stream)
    {
        FourSer.Gen.Helpers.StreamWriterHelpers.WriteInt32(stream, (Int32)obj.A);
    }
}


// <auto-generated/>
using System;
using System.Buffers.Binary;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using FourSer.Contracts;
using System.IO;
using FourSer.Gen.Helpers;
using SpanReader = FourSer.Gen.Helpers.RoSpanReaderHelpers;
using StreamReader = FourSer.Gen.Helpers.StreamReaderHelpers;

namespace FourSer.Tests.GeneratorTestCases.ListOfStructs;

public partial class PacketWithListOfStructs : ISerializable<PacketWithListOfStructs>
{
    public static int GetPacketSize(PacketWithListOfStructs obj)
    {
        var size = 0;
        size += sizeof(int); // Count size for Structs
        foreach(var item in obj.Structs)
        {
            size += MyStruct.GetPacketSize(item);
        }
        return size;
    }

    private PacketWithListOfStructs(System.Collections.Generic.List<FourSer.Tests.GeneratorTestCases.ListOfStructs.MyStruct> structs)
    {
        this.Structs = structs;
    }

    public PacketWithListOfStructs()
    {
        this.Structs = default;
    }

    public static PacketWithListOfStructs Deserialize(ref System.ReadOnlySpan<byte> buffer)
    {
        var structsCount = SpanReader.ReadInt32(ref buffer);
        var structs = new System.Collections.Generic.List<FourSer.Tests.GeneratorTestCases.ListOfStructs.MyStruct>(structsCount);
        for (int i = 0; i < structsCount; i++)
        {
            structs.Add(MyStruct.Deserialize(ref buffer));
        }
        var obj = new PacketWithListOfStructs(structs);
        return obj;
    }

    public static PacketWithListOfStructs Deserialize(System.ReadOnlySpan<byte> buffer)
    {
        return Deserialize(ref buffer);
    }

    public static PacketWithListOfStructs Deserialize(System.IO.Stream stream)
    {
        var structsCount = StreamReader.ReadInt32(stream);
        var structs = new System.Collections.Generic.List<FourSer.Tests.GeneratorTestCases.ListOfStructs.MyStruct>(structsCount);
        for (int i = 0; i < structsCount; i++)
        {
            structs.Add(MyStruct.Deserialize(stream));
        }
        var obj = new PacketWithListOfStructs(structs);
        return obj;
    }

    public static int Serialize(PacketWithListOfStructs obj, System.Span<byte> data)
    {
        var originalData = data;
        if (obj.Structs is null)
        {
            throw new System.NullReferenceException($"Collection \"Structs\" cannot be null.");
        }
        else
        {
            FourSer.Gen.Helpers.SpanWriterHelpers.WriteInt32(ref data, (int)obj.Structs.Count);
            for (int i = 0; i < obj.Structs.Count; i++)
            {
                var bytesWritten = MyStruct.Serialize(obj.Structs[i], data);
                data = data.Slice(bytesWritten);
            }
        }
        return originalData.Length - data.Length;
    }

    public static void Serialize(PacketWithListOfStructs obj, System.IO.Stream stream)
    {
        if (obj.Structs is null)
        {
            throw new System.NullReferenceException($"Collection \"Structs\" cannot be null.");
        }
        else
        {
            FourSer.Gen.Helpers.StreamWriterHelpers.WriteInt32(stream, (int)obj.Structs.Count);
            for (int i = 0; i < obj.Structs.Count; i++)
            {
                MyStruct.Serialize(obj.Structs[i], stream);
            }
        }
    }
}
